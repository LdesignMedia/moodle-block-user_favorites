{"version":3,"file":"favorites.min.js","sources":["../src/favorites.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Tested in Moodle 3.5\n *\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n *\n * @copyright 2018 MFreak.nl\n * @author    Luuk Verhoeven\n **/\n\n/* eslint no-unused-expressions: \"off\", no-console:off, no-invalid-this:\"off\",no-script-url:\"off\", block-scoped-var: \"off\" */\ndefine(['jquery', 'core/ajax', 'core/notification', 'core/log'], function ($, Ajax, Notification, Log) {\n\n    /**\n     * Opts that are possible to set.\n     *\n     * @type {{id: number, debugjs: boolean}}\n     */\n    var opts = {\n        debugjs: true,\n        id: 0,\n        url: '',\n        hash: ''\n    };\n\n    /**\n     * Set options base on listed options\n     * @param {object} options\n     */\n    var setOptions = function (options) {\n        \"use strict\";\n        var key, vartype;\n        for (key in opts) {\n            if (opts.hasOwnProperty(key) && options.hasOwnProperty(key)) {\n\n                // Casting to prevent errors.\n                vartype = typeof opts[key];\n                if (vartype === \"boolean\") {\n                    opts[key] = Boolean(options[key]);\n                } else if (vartype === 'number') {\n                    opts[key] = Number(options[key]);\n                } else if (vartype === 'string') {\n                    opts[key] = String(options[key]);\n                }\n                // Skip all other types.\n            }\n        }\n    };\n\n    /**\n     * Console log debug wrapper.\n     */\n    var debug = {};\n\n    /**\n     * Set debug mode\n     * Should only be enabled if site is in debug mode.\n     * @param {boolean} isenabled\n     */\n    var setDebug = function (isenabled) {\n\n        if (isenabled) {\n            for (var m in console) {\n                if (typeof console[m] == 'function') {\n                    debug[m] = console[m].bind(window.console);\n                }\n            }\n        } else {\n\n            // Fake wrapper.\n            for (var i in console) {\n                if (typeof console[i] == 'function') {\n                    debug[i] = function () {\n                        // Don't do anything.\n                    };\n                }\n            }\n        }\n    };\n\n    var favoritesModule = {\n\n        /**\n         * Add or update a url\n         *\n         * @param {object} data\n         * @param {string} title\n         */\n        setUrl: function (data, title) {\n\n            Notification.confirm(M.util.get_string('javascript:set_title', 'block_user_favorites'),\n                '<input class=\"form-control\" id=\"favorite-url\" value=\"' + title + '\">',\n                M.util.get_string('javascript:yes', 'block_user_favorites'),\n                M.util.get_string('javascript:no', 'block_user_favorites'), function () {\n\n                    var request = Ajax.call([{\n                        methodname: 'block_user_favorites_set_url',\n                        args: {\n                            hash: data.hash,\n                            optional: {\n                                url: data.url,\n                                action: data.action,\n                            },\n                            title: $('#favorite-url').val(),\n                            blockid: opts.id,\n                        }\n                    }]);\n\n                    request[0].done(function (response) {\n                        debug.log(response);\n                        favoritesModule.reload();\n                    }).fail(Notification.exception);\n                });\n        },\n\n        /**\n         * Delete a url\n         *\n         * @param {object} data\n         */\n        remove: function (data) {\n\n            var request = Ajax.call([{\n                methodname: 'block_user_favorites_delete_url',\n                args: {\n                    hash: data.hash,\n                    blockid: opts.id,\n                }\n            }]);\n\n            request[0].done(function (response) {\n                debug.log(response);\n                favoritesModule.reload();\n            }).fail(Notification.exception);\n        },\n\n        /**\n         * Reload the block\n         */\n        reload: function () {\n\n            var request = Ajax.call([{\n                methodname: 'block_user_favorites_content',\n                args: {\n                    url: opts.url,\n                    blockid: opts.id,\n                }\n            }]);\n\n            request[0].done(function (response) {\n                debug.log(response);\n                $('.block_user_favorites .content').html(response.content);\n            }).fail(Notification.exception);\n        },\n\n        /**\n         * Init event triggers.\n         */\n        init: function () {\n\n            $('.block_user_favorites').on('click', '#block_user_favorites_set', function () {\n\n                Log.log('Set URL to favorites: ' + window.location.href);\n\n                // Set current as favorite.\n                favoritesModule.setUrl({\n                    'action': 'add',\n                    'hash': opts.hash,\n                    'url': window.location.href,\n                }, $('title').text());\n\n            }).on('click', '#block_user_favorites_delete', function () {\n                // Delete current pages from favorites.\n                favoritesModule.remove({\n                    'hash': opts.hash,\n                });\n\n            }).on('click', '.fa-remove', function () {\n                // Remove a fav in the list.\n                favoritesModule.remove($(this).closest('li').data());\n\n            }).on('click', '.fa-edit', function () {\n                // Edit a fav int the list.\n                var data = $(this).parent().parent().data();\n                data.url = null;\n                data.action = 'edit';\n                favoritesModule.setUrl(data, $(this).parent().parent().find('a').text());\n            });\n        }\n    };\n\n    return {\n        /**\n         * Init\n         *\n         * @param {object} args\n         */\n        initialise: function (args) {\n\n            // Load the args passed from PHP.\n            setOptions(args);\n\n            // Set internal debug console.\n            setDebug(opts.debugjs);\n\n            $.noConflict();\n            $(document).ready(function () {\n                debug.log('Block User Favorites v1.2');\n                favoritesModule.init();\n            });\n        }\n    };\n});\n"],"names":["define","$","Ajax","Notification","Log","opts","debugjs","id","url","hash","debug","favoritesModule","setUrl","data","title","confirm","M","util","get_string","call","methodname","args","optional","action","val","blockid","done","response","log","reload","fail","exception","remove","html","content","init","on","window","location","href","text","this","closest","parent","find","initialise","options","key","vartype","hasOwnProperty","Boolean","Number","String","setOptions","isenabled","m","console","bind","i","setDebug","noConflict","document","ready"],"mappings":";;;;;;;;KAyBAA,wCAAO,CAAC,SAAU,YAAa,oBAAqB,aAAa,SAAUC,EAAGC,KAAMC,aAAcC,SAO1FC,KAAO,CACPC,SAAS,EACTC,GAAI,EACJC,IAAK,GACLC,KAAM,IA8BNC,MAAQ,GA4BRC,gBAAkB,CAQlBC,OAAQ,SAAUC,KAAMC,OAEpBX,aAAaY,QAAQC,EAAEC,KAAKC,WAAW,uBAAwB,wBAC3D,wDAA0DJ,MAAQ,KAClEE,EAAEC,KAAKC,WAAW,iBAAkB,wBACpCF,EAAEC,KAAKC,WAAW,gBAAiB,yBAAyB,WAE1ChB,KAAKiB,KAAK,CAAC,CACrBC,WAAY,+BACZC,KAAM,CACFZ,KAAMI,KAAKJ,KACXa,SAAU,CACNd,IAAKK,KAAKL,IACVe,OAAQV,KAAKU,QAEjBT,MAAOb,EAAE,iBAAiBuB,MAC1BC,QAASpB,KAAKE,OAId,GAAGmB,MAAK,SAAUC,UACtBjB,MAAMkB,IAAID,UACVhB,gBAAgBkB,YACjBC,KAAK3B,aAAa4B,eASjCC,OAAQ,SAAUnB,MAEAX,KAAKiB,KAAK,CAAC,CACrBC,WAAY,kCACZC,KAAM,CACFZ,KAAMI,KAAKJ,KACXgB,QAASpB,KAAKE,OAId,GAAGmB,MAAK,SAAUC,UACtBjB,MAAMkB,IAAID,UACVhB,gBAAgBkB,YACjBC,KAAK3B,aAAa4B,YAMzBF,OAAQ,WAEU3B,KAAKiB,KAAK,CAAC,CACrBC,WAAY,+BACZC,KAAM,CACFb,IAAKH,KAAKG,IACViB,QAASpB,KAAKE,OAId,GAAGmB,MAAK,SAAUC,UACtBjB,MAAMkB,IAAID,UACV1B,EAAE,kCAAkCgC,KAAKN,SAASO,YACnDJ,KAAK3B,aAAa4B,YAMzBI,KAAM,WAEFlC,EAAE,yBAAyBmC,GAAG,QAAS,6BAA6B,WAEhEhC,IAAIwB,IAAI,yBAA2BS,OAAOC,SAASC,MAGnD5B,gBAAgBC,OAAO,QACT,WACFP,KAAKI,SACN4B,OAAOC,SAASC,MACxBtC,EAAE,SAASuC,WAEfJ,GAAG,QAAS,gCAAgC,WAE3CzB,gBAAgBqB,OAAO,MACX3B,KAAKI,UAGlB2B,GAAG,QAAS,cAAc,WAEzBzB,gBAAgBqB,OAAO/B,EAAEwC,MAAMC,QAAQ,MAAM7B,WAE9CuB,GAAG,QAAS,YAAY,eAEnBvB,KAAOZ,EAAEwC,MAAME,SAASA,SAAS9B,OACrCA,KAAKL,IAAM,KACXK,KAAKU,OAAS,OACdZ,gBAAgBC,OAAOC,KAAMZ,EAAEwC,MAAME,SAASA,SAASC,KAAK,KAAKJ,mBAKtE,CAMHK,WAAY,SAAUxB,OAxKT,SAAUyB,aAEnBC,IAAKC,YACJD,OAAO1C,KACJA,KAAK4C,eAAeF,MAAQD,QAAQG,eAAeF,OAInC,aADhBC,gBAAiB3C,KAAK0C,OAElB1C,KAAK0C,KAAOG,QAAQJ,QAAQC,MACT,WAAZC,QACP3C,KAAK0C,KAAOI,OAAOL,QAAQC,MACR,WAAZC,UACP3C,KAAK0C,KAAOK,OAAON,QAAQC,QA8JnCM,CAAWhC,MA7IJ,SAAUiC,cAEjBA,cACK,IAAIC,KAAKC,QACe,mBAAdA,QAAQD,KACf7C,MAAM6C,GAAKC,QAAQD,GAAGE,KAAKpB,OAAOmB,mBAMrC,IAAIE,KAAKF,QACe,mBAAdA,QAAQE,KACfhD,MAAMgD,GAAK,cAmInBC,CAAStD,KAAKC,SAEdL,EAAE2D,aACF3D,EAAE4D,UAAUC,OAAM,WACdpD,MAAMkB,IAAI,6BACVjB,gBAAgBwB"}